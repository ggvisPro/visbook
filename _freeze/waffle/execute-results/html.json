{
  "hash": "1452dc88aac536fdfbb68225bfd73935",
  "result": {
    "engine": "knitr",
    "markdown": "# Waffle {#sec-waffle}\n\nWaffle chart 通过一个小方块网格直观地表示分类数据，形状像华夫饼。\n\n每个小方块代表一个单位，每个类别有一种颜色，通常用于展示百分比或比例数据。\n\n`waffle` 包提供两种不同的 API（应用程序编程接口）。第一种类似于基础 R 语法，使用 `waffle()` 函数。第二种 `geom_waffle()` 符合 tidyverse 理念，可以无缝集成到 ggplot2 调用中。\n\n## PKG\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(waffle)\nlibrary(tidyverse)   \nlibrary(ggtext)    \nlibrary(rnaturalearth) # 获取世界地图数据\nlibrary(sf)           # 处理空间数据\n```\n:::\n\n\n## `Base R`\n\n### 基本\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 构造示例数据\ngroup <- c(\"group-1\", \"group-2\", \"group-3\")\nvalue <- c(13, 5, 22)\ndata <- data.frame(group, value)\n\n# 绘制华夫饼图\nwaffle(data)\n```\n\n::: {.cell-output-display}\n![基础 R 语言绘制华夫饼图](waffle_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n### `rows`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwaffle(data, rows = 5)\n```\n\n::: {.cell-output-display}\n![通过 `rows` 参数设置华夫饼图的行数](waffle_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n### `colors`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwaffle(data, rows = 5, colors = c(\"#fb5607\", \"#ff006e\", \"#8338ec\"))\n```\n\n::: {.cell-output-display}\n![通过 `colors` 参数设置华夫饼图的颜色](waffle_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n### `Legend`\n\n 通过 `legend_pos` 参数设置图例位置\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwaffle(\n    data,\n    rows = 5,\n    colors = c(\"#fb5607\", \"#ff006e\", \"#8338ec\"),\n    legend_pos = \"bottom\"\n)\n```\n\n::: {.cell-output-display}\n![通过 `legend_pos` 参数设置图例位置](waffle_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n## `ggplot2`\n\n`geom_waffle()` 可以在 ggplot2 中使用。\n\n### 基本\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data, aes(fill=group, values=value)) +\n  geom_waffle() +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![使用 ggplot2 绘制华夫饼图](waffle_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n### 颜色\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data, aes(fill=group, values=value)) +\n  geom_waffle(color = \"white\") + # 添加白色边框\n  scale_fill_brewer(palette = \"Set2\") + # 使用 Set2 调色板\n  theme_void()\n```\n\n::: {.cell-output-display}\n![使用 ggplot2 绘制华夫饼图，修改颜色](waffle_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n### `Legend`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data, aes(fill=group, values=value)) +\n  geom_waffle() +\n  scale_fill_manual(\n    values = c(\"#999999\", \"#E69F00\", \"#56B4E9\"),\n    labels = c(\"First group\", \"Second group\", \"Third group\")) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![使用 ggplot2 绘制华夫饼图，修改图例](waffle_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n### subgroup\n\n通过对group分面，可以得到每个组的子组分布情况。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 构造带有 subgroup 的示例数据\ndata <- data.frame(\n    group = c(\n        \"First group\",\n        \"First group\",\n        \"First group\",\n        \"First group\",\n        \"First group\",\n        \"First group\",\n        \"Second group\",\n        \"Second group\",\n        \"Second group\",\n        \"Second group\",\n        \"Third group\",\n        \"Third group\"\n    ),\n    subgroup = c(\"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"A\", \"B\", \"C\", \"D\", \"A\", \"B\"),\n    value = c(10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120)\n)\n\nggplot(data = data, aes(fill = subgroup, values = value)) +\n    geom_waffle(color = \"white\", size = 1.125, n_rows = 6) +\n    facet_wrap(~group, ncol = 1) + # 关键是分面 facet_wrap\n    theme_void()\n```\n\n::: {.cell-output-display}\n![使用 ggplot2 绘制华夫饼图，分组显示](waffle_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n### 颜色\n\n可以使用 `scale_fill_manual()` 来修改颜色。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = data, aes(fill = subgroup, values = value)) +\n    geom_waffle(color = \"white\", size = 1.125, n_rows = 6) +\n    facet_wrap(~group, ncol = 1) +\n    theme_void() +\n    scale_fill_manual(\n        values = c(\n            \"#69b3a2\",\n            \"#404080\",\n            \"#FFA07A\",\n            \"#FFD700\",\n            \"#FF6347\",\n            \"#4682B4\"\n        )\n    )\n```\n\n::: {.cell-output-display}\n![scale_fill_manual() 修改颜色](waffle_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n或者使用我更爱的 `scale_fill_brewer(palette = \"Set2\")` 来使用预定义的调色板。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = data, aes(fill = subgroup, values = value)) +\n    geom_waffle(color = \"white\", size = 1.125, n_rows = 6) +\n    facet_wrap(~group, ncol = 1) +\n    theme_void() +\n    scale_fill_brewer(palette = \"Set2\")\n```\n\n::: {.cell-output-display}\n![scale_fill_brewer() 更改颜色](waffle_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n## Pearl\n\n2010-2020年全球 [各大洲小麦产量](https://r-graph-gallery.com/web-waffle-chart-for-distribution.html) 分布的华夫饼图：\n\n![2010-2020年全球各大洲小麦/玉米产量分布](./image/wheat.png)\n\n\n[大西洋飓风数量](https://r-graph-gallery.com/web-waffle-for-time-evolution.html) 分布的华夫饼图：\n\n![大西洋飓风数量分布的华夫饼图](./image/storms.png)\n\n\n不同大洲作为动物饲料消耗的 [谷物比例](https://r-graph-gallery.com/web-waffle-chart-share.html):\n\n![不同大洲作为动物饲料消耗的谷物比例](./image/cereals.png)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}