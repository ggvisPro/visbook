{
  "hash": "74058e4ee368b219f3e7f745f71ecb80",
  "result": {
    "engine": "knitr",
    "markdown": "# Conn-Scatter {#sec-connected-scatter}\n\n## PKG \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(hrbrthemes) # 主题\nlibrary(babynames) # 数据集\nlibrary(ggrepel) # 标签\nlibrary(dygraphs)      # 用于绘制交互式时间序列图\nlibrary(xts)           # 用于数据框与 xts 格式转换\nlibrary(tidyverse)     # 数据处理\nlibrary(lubridate)     # 处理日期时间\n```\n:::\n\n\n## 基础\n\n`geom_point()` 和 `geom_line()` 组合在一起。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 读取数据，并将日期列转换为 Date 类型\ndata <- read.table(\"https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/3_TwoNumOrdered.csv\", header=T)\ndata$date <- as.Date(data$date)\n\n# 取数据的最后10行，绘制连接散点图\ndata |>\n    tail(10) |>\n    ggplot(aes(x = date, y = value)) +\n    geom_line() +   # 添加连线\n    geom_point()    # 添加散点\n```\n\n::: {.cell-output-display}\n![连接散点图](connected-scatter_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n## 主题\n\n使用 `hrbrthemes::theme_ipsum()` 函数自定义主题。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 取数据的最后10行，绘制连接散点图，并自定义主题\ndata |>\n    tail(10) |>\n    ggplot(aes(x = date, y = value)) +\n    geom_line(color = \"grey\") +  # 添加灰色连线\n    geom_point(shape = 21, color = \"black\", fill = \"#69b3a2\", size = 6) +  # 添加带填充色的点\n    theme_ipsum() +  # 应用 hrbrthemes 的主题\n    ggtitle(\"Evolution of bitcoin price\")  # 添加标题\n```\n\n::: {.cell-output-display}\n![theme_ipsum() 定制主题](connected-scatter_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n## 演变\n\n连接散点图也可以是一种强大的技术，用来讲述两个变量演变的故事。\n\n下面的示例展示了美国名为 *Amanda* 和 *Ashley* 的婴儿数量演变。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 筛选1970年后的女性婴儿，名字为 Ashley 或 Amanda 的数据\ndata <- babynames |>\n  filter(name %in% c(\"Ashley\", \"Amanda\")) |> # 只保留 Ashley 和 Amanda\n  filter(sex == \"F\") |> # 只保留女性\n  filter(year > 1970) |> # 只保留1970年后的数据\n  select(year, name, n) |> # 选择年份、名字和数量\n  spread(key = name, value = n, -1) # 宽数据格式，每列为一个名字\n\n# 绘图：x轴为 Amanda，y轴为 Ashley，标签为年份\ndata |>\n  ggplot(aes(x = Amanda, y = Ashley, label = year)) +\n  geom_point() + # 绘制散点\n  geom_segment(aes(\n    xend = c(tail(Amanda, n = -1), NA), # 连接相邻年份的点\n    yend = c(tail(Ashley, n = -1), NA)\n  ))\n```\n\n::: {.cell-output-display}\n![Ashley 和 Amanda 名字在美国的流行演变（1970年后，女婴）](connected-scatter_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n再改进一下，在图表中添加箭头和标签来引导读者：\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 随机选择部分年份用于标签\ntmp_date <- data %>% sample_frac(0.3)\n\n# 绘图\ndata %>%\n  ggplot(aes(x = Amanda, y = Ashley, label = year)) +\n  geom_point(color = \"#69b3a2\") + # 绘制散点\n  geom_text_repel(data = tmp_date) + # 添加年份标签，避免重叠\n  geom_segment(\n    color = \"#69b3a2\",\n    aes(\n      xend = c(tail(Amanda, n = -1), NA), # 连接相邻年份的点\n      yend = c(tail(Ashley, n = -1), NA)\n    ),\n    arrow = arrow(length = unit(0.3, \"cm\")) # 添加箭头\n  ) +\n  theme_ipsum() # 应用主题\n```\n\n::: {.cell-output-display}\n![Ashley 和 Amanda 名字在美国的流行演变（带箭头和标签，1970年后，女婴）](connected-scatter_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n## Time series\n\n交互式时间序列图：巴黎 Vélib 自行车租赁数据（前300条）： \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 加载所需包\n# library(dygraphs)      # 用于绘制交互式时间序列图\n# library(xts)           # 用于数据框与 xts 格式转换\n# library(tidyverse)     # 数据处理\n# library(lubridate)     # 处理日期时间\n\n# 读取数据\npath = 'https://raw.githubusercontent.com/holtzy/R-graph-gallery/master/DATA/bike.csv'\ndata <- read.table(path, header = TRUE, sep = \",\") %>% head(300) # 取前300行数据\n\n# 将时间列从因子/字符转换为日期时间格式\ndata$datetime <- ymd_hms(data$datetime)\n\n# 创建 xts 对象，dygraph 需要此格式\n# x = 观测值，order.by = 时间索引\ndon <- xts(x = data$count, order.by = data$datetime)\n\n# 绘制交互式时间序列图\ndygraph(don) |>\n    dyOptions(\n        labelsUTC = TRUE,         # 使用 UTC 时间标签\n        fillGraph = TRUE,         # 填充曲线下方区域\n        fillAlpha = 0.1,          # 填充透明度\n        drawGrid = FALSE,         # 不显示网格线\n        colors = \"#D8AE5A\"        # 曲线颜色\n    ) |>\n    dyRangeSelector() |>\n    dyCrosshair(direction = \"vertical\") |>\n    dyHighlight(\n        highlightCircleSize = 5,                  # 鼠标悬停时点的大小\n        highlightSeriesBackgroundAlpha = 0.2,     # 高亮系列的背景透明度\n        hideOnMouseOut = FALSE                    # 鼠标移出时是否隐藏高亮\n    ) |>\n    dyRoller(rollPeriod = 1)                    # 滚动平均窗口大小\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"dygraphs html-widget html-fill-item\" id=\"htmlwidget-23d7407b99f90df5de14\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-23d7407b99f90df5de14\">{\"x\":{\"attrs\":{\"labels\":[\"hour\",\"V1\"],\"legend\":\"auto\",\"retainDateWindow\":false,\"axes\":{\"x\":{\"pixelsPerLabel\":60,\"drawAxis\":true},\"y\":{\"drawAxis\":true}},\"stackedGraph\":false,\"fillGraph\":true,\"fillAlpha\":0.1,\"stepPlot\":false,\"drawPoints\":false,\"pointSize\":1,\"drawGapEdgePoints\":false,\"connectSeparatedPoints\":false,\"strokeWidth\":1,\"strokeBorderColor\":\"white\",\"colors\":[\"#D8AE5A\"],\"colorValue\":0.5,\"colorSaturation\":1,\"includeZero\":false,\"drawAxesAtZero\":false,\"logscale\":false,\"axisTickSize\":3,\"axisLineColor\":\"black\",\"axisLineWidth\":0.3,\"axisLabelColor\":\"black\",\"axisLabelFontSize\":14,\"axisLabelWidth\":60,\"drawGrid\":false,\"gridLineWidth\":0.3,\"rightGap\":5,\"digitsAfterDecimal\":2,\"labelsKMB\":false,\"labelsKMG2\":false,\"labelsUTC\":true,\"maxNumberWidth\":6,\"animatedZooms\":false,\"mobileDisableYTouch\":true,\"disableZoom\":false,\"showRangeSelector\":true,\"rangeSelectorHeight\":40,\"rangeSelectorPlotFillColor\":\" #A7B1C4\",\"rangeSelectorPlotStrokeColor\":\"#808FAB\",\"interactionModel\":\"Dygraph.Interaction.defaultModel\",\"highlightCircleSize\":5,\"highlightSeriesBackgroundAlpha\":0.2,\"highlightSeriesOpts\":[],\"hideOverlayOnMouseOut\":false,\"showRoller\":true,\"rollPeriod\":1},\"scale\":\"hourly\",\"annotations\":[],\"shadings\":[],\"events\":[],\"format\":\"date\",\"data\":[[\"2011-01-01T00:00:00.000Z\",\"2011-01-01T01:00:00.000Z\",\"2011-01-01T02:00:00.000Z\",\"2011-01-01T03:00:00.000Z\",\"2011-01-01T04:00:00.000Z\",\"2011-01-01T05:00:00.000Z\",\"2011-01-01T06:00:00.000Z\",\"2011-01-01T07:00:00.000Z\",\"2011-01-01T08:00:00.000Z\",\"2011-01-01T09:00:00.000Z\",\"2011-01-01T10:00:00.000Z\",\"2011-01-01T11:00:00.000Z\",\"2011-01-01T12:00:00.000Z\",\"2011-01-01T13:00:00.000Z\",\"2011-01-01T14:00:00.000Z\",\"2011-01-01T15:00:00.000Z\",\"2011-01-01T16:00:00.000Z\",\"2011-01-01T17:00:00.000Z\",\"2011-01-01T18:00:00.000Z\",\"2011-01-01T19:00:00.000Z\",\"2011-01-01T20:00:00.000Z\",\"2011-01-01T21:00:00.000Z\",\"2011-01-01T22:00:00.000Z\",\"2011-01-01T23:00:00.000Z\",\"2011-01-02T00:00:00.000Z\",\"2011-01-02T01:00:00.000Z\",\"2011-01-02T02:00:00.000Z\",\"2011-01-02T03:00:00.000Z\",\"2011-01-02T04:00:00.000Z\",\"2011-01-02T06:00:00.000Z\",\"2011-01-02T07:00:00.000Z\",\"2011-01-02T08:00:00.000Z\",\"2011-01-02T09:00:00.000Z\",\"2011-01-02T10:00:00.000Z\",\"2011-01-02T11:00:00.000Z\",\"2011-01-02T12:00:00.000Z\",\"2011-01-02T13:00:00.000Z\",\"2011-01-02T14:00:00.000Z\",\"2011-01-02T15:00:00.000Z\",\"2011-01-02T16:00:00.000Z\",\"2011-01-02T17:00:00.000Z\",\"2011-01-02T18:00:00.000Z\",\"2011-01-02T19:00:00.000Z\",\"2011-01-02T20:00:00.000Z\",\"2011-01-02T21:00:00.000Z\",\"2011-01-02T22:00:00.000Z\",\"2011-01-02T23:00:00.000Z\",\"2011-01-03T00:00:00.000Z\",\"2011-01-03T01:00:00.000Z\",\"2011-01-03T04:00:00.000Z\",\"2011-01-03T05:00:00.000Z\",\"2011-01-03T06:00:00.000Z\",\"2011-01-03T07:00:00.000Z\",\"2011-01-03T08:00:00.000Z\",\"2011-01-03T09:00:00.000Z\",\"2011-01-03T10:00:00.000Z\",\"2011-01-03T11:00:00.000Z\",\"2011-01-03T12:00:00.000Z\",\"2011-01-03T13:00:00.000Z\",\"2011-01-03T14:00:00.000Z\",\"2011-01-03T15:00:00.000Z\",\"2011-01-03T16:00:00.000Z\",\"2011-01-03T17:00:00.000Z\",\"2011-01-03T18:00:00.000Z\",\"2011-01-03T19:00:00.000Z\",\"2011-01-03T20:00:00.000Z\",\"2011-01-03T21:00:00.000Z\",\"2011-01-03T22:00:00.000Z\",\"2011-01-03T23:00:00.000Z\",\"2011-01-04T00:00:00.000Z\",\"2011-01-04T01:00:00.000Z\",\"2011-01-04T02:00:00.000Z\",\"2011-01-04T04:00:00.000Z\",\"2011-01-04T05:00:00.000Z\",\"2011-01-04T06:00:00.000Z\",\"2011-01-04T07:00:00.000Z\",\"2011-01-04T08:00:00.000Z\",\"2011-01-04T09:00:00.000Z\",\"2011-01-04T10:00:00.000Z\",\"2011-01-04T11:00:00.000Z\",\"2011-01-04T12:00:00.000Z\",\"2011-01-04T13:00:00.000Z\",\"2011-01-04T14:00:00.000Z\",\"2011-01-04T15:00:00.000Z\",\"2011-01-04T16:00:00.000Z\",\"2011-01-04T17:00:00.000Z\",\"2011-01-04T18:00:00.000Z\",\"2011-01-04T19:00:00.000Z\",\"2011-01-04T20:00:00.000Z\",\"2011-01-04T21:00:00.000Z\",\"2011-01-04T22:00:00.000Z\",\"2011-01-04T23:00:00.000Z\",\"2011-01-05T00:00:00.000Z\",\"2011-01-05T01:00:00.000Z\",\"2011-01-05T02:00:00.000Z\",\"2011-01-05T04:00:00.000Z\",\"2011-01-05T05:00:00.000Z\",\"2011-01-05T06:00:00.000Z\",\"2011-01-05T07:00:00.000Z\",\"2011-01-05T08:00:00.000Z\",\"2011-01-05T09:00:00.000Z\",\"2011-01-05T10:00:00.000Z\",\"2011-01-05T11:00:00.000Z\",\"2011-01-05T12:00:00.000Z\",\"2011-01-05T13:00:00.000Z\",\"2011-01-05T14:00:00.000Z\",\"2011-01-05T15:00:00.000Z\",\"2011-01-05T16:00:00.000Z\",\"2011-01-05T17:00:00.000Z\",\"2011-01-05T18:00:00.000Z\",\"2011-01-05T19:00:00.000Z\",\"2011-01-05T20:00:00.000Z\",\"2011-01-05T21:00:00.000Z\",\"2011-01-05T22:00:00.000Z\",\"2011-01-05T23:00:00.000Z\",\"2011-01-06T00:00:00.000Z\",\"2011-01-06T01:00:00.000Z\",\"2011-01-06T02:00:00.000Z\",\"2011-01-06T04:00:00.000Z\",\"2011-01-06T05:00:00.000Z\",\"2011-01-06T06:00:00.000Z\",\"2011-01-06T07:00:00.000Z\",\"2011-01-06T08:00:00.000Z\",\"2011-01-06T09:00:00.000Z\",\"2011-01-06T10:00:00.000Z\",\"2011-01-06T11:00:00.000Z\",\"2011-01-06T12:00:00.000Z\",\"2011-01-06T13:00:00.000Z\",\"2011-01-06T14:00:00.000Z\",\"2011-01-06T15:00:00.000Z\",\"2011-01-06T16:00:00.000Z\",\"2011-01-06T17:00:00.000Z\",\"2011-01-06T18:00:00.000Z\",\"2011-01-06T19:00:00.000Z\",\"2011-01-06T20:00:00.000Z\",\"2011-01-06T21:00:00.000Z\",\"2011-01-06T22:00:00.000Z\",\"2011-01-06T23:00:00.000Z\",\"2011-01-07T00:00:00.000Z\",\"2011-01-07T01:00:00.000Z\",\"2011-01-07T02:00:00.000Z\",\"2011-01-07T04:00:00.000Z\",\"2011-01-07T05:00:00.000Z\",\"2011-01-07T06:00:00.000Z\",\"2011-01-07T07:00:00.000Z\",\"2011-01-07T08:00:00.000Z\",\"2011-01-07T09:00:00.000Z\",\"2011-01-07T10:00:00.000Z\",\"2011-01-07T11:00:00.000Z\",\"2011-01-07T12:00:00.000Z\",\"2011-01-07T13:00:00.000Z\",\"2011-01-07T14:00:00.000Z\",\"2011-01-07T15:00:00.000Z\",\"2011-01-07T16:00:00.000Z\",\"2011-01-07T17:00:00.000Z\",\"2011-01-07T18:00:00.000Z\",\"2011-01-07T19:00:00.000Z\",\"2011-01-07T20:00:00.000Z\",\"2011-01-07T21:00:00.000Z\",\"2011-01-07T22:00:00.000Z\",\"2011-01-07T23:00:00.000Z\",\"2011-01-08T00:00:00.000Z\",\"2011-01-08T01:00:00.000Z\",\"2011-01-08T02:00:00.000Z\",\"2011-01-08T03:00:00.000Z\",\"2011-01-08T04:00:00.000Z\",\"2011-01-08T05:00:00.000Z\",\"2011-01-08T06:00:00.000Z\",\"2011-01-08T07:00:00.000Z\",\"2011-01-08T08:00:00.000Z\",\"2011-01-08T09:00:00.000Z\",\"2011-01-08T10:00:00.000Z\",\"2011-01-08T11:00:00.000Z\",\"2011-01-08T12:00:00.000Z\",\"2011-01-08T13:00:00.000Z\",\"2011-01-08T14:00:00.000Z\",\"2011-01-08T15:00:00.000Z\",\"2011-01-08T16:00:00.000Z\",\"2011-01-08T17:00:00.000Z\",\"2011-01-08T18:00:00.000Z\",\"2011-01-08T19:00:00.000Z\",\"2011-01-08T20:00:00.000Z\",\"2011-01-08T21:00:00.000Z\",\"2011-01-08T22:00:00.000Z\",\"2011-01-08T23:00:00.000Z\",\"2011-01-09T00:00:00.000Z\",\"2011-01-09T01:00:00.000Z\",\"2011-01-09T02:00:00.000Z\",\"2011-01-09T03:00:00.000Z\",\"2011-01-09T04:00:00.000Z\",\"2011-01-09T05:00:00.000Z\",\"2011-01-09T06:00:00.000Z\",\"2011-01-09T07:00:00.000Z\",\"2011-01-09T08:00:00.000Z\",\"2011-01-09T09:00:00.000Z\",\"2011-01-09T10:00:00.000Z\",\"2011-01-09T11:00:00.000Z\",\"2011-01-09T12:00:00.000Z\",\"2011-01-09T13:00:00.000Z\",\"2011-01-09T14:00:00.000Z\",\"2011-01-09T15:00:00.000Z\",\"2011-01-09T16:00:00.000Z\",\"2011-01-09T17:00:00.000Z\",\"2011-01-09T18:00:00.000Z\",\"2011-01-09T19:00:00.000Z\",\"2011-01-09T20:00:00.000Z\",\"2011-01-09T21:00:00.000Z\",\"2011-01-09T22:00:00.000Z\",\"2011-01-09T23:00:00.000Z\",\"2011-01-10T00:00:00.000Z\",\"2011-01-10T01:00:00.000Z\",\"2011-01-10T02:00:00.000Z\",\"2011-01-10T03:00:00.000Z\",\"2011-01-10T04:00:00.000Z\",\"2011-01-10T05:00:00.000Z\",\"2011-01-10T06:00:00.000Z\",\"2011-01-10T07:00:00.000Z\",\"2011-01-10T08:00:00.000Z\",\"2011-01-10T09:00:00.000Z\",\"2011-01-10T10:00:00.000Z\",\"2011-01-10T11:00:00.000Z\",\"2011-01-10T12:00:00.000Z\",\"2011-01-10T13:00:00.000Z\",\"2011-01-10T14:00:00.000Z\",\"2011-01-10T15:00:00.000Z\",\"2011-01-10T16:00:00.000Z\",\"2011-01-10T17:00:00.000Z\",\"2011-01-10T18:00:00.000Z\",\"2011-01-10T19:00:00.000Z\",\"2011-01-10T20:00:00.000Z\",\"2011-01-10T21:00:00.000Z\",\"2011-01-10T22:00:00.000Z\",\"2011-01-10T23:00:00.000Z\",\"2011-01-11T00:00:00.000Z\",\"2011-01-11T01:00:00.000Z\",\"2011-01-11T02:00:00.000Z\",\"2011-01-11T05:00:00.000Z\",\"2011-01-11T06:00:00.000Z\",\"2011-01-11T07:00:00.000Z\",\"2011-01-11T08:00:00.000Z\",\"2011-01-11T09:00:00.000Z\",\"2011-01-11T10:00:00.000Z\",\"2011-01-11T11:00:00.000Z\",\"2011-01-11T12:00:00.000Z\",\"2011-01-11T13:00:00.000Z\",\"2011-01-11T14:00:00.000Z\",\"2011-01-11T15:00:00.000Z\",\"2011-01-11T16:00:00.000Z\",\"2011-01-11T17:00:00.000Z\",\"2011-01-11T18:00:00.000Z\",\"2011-01-11T19:00:00.000Z\",\"2011-01-11T20:00:00.000Z\",\"2011-01-11T21:00:00.000Z\",\"2011-01-11T22:00:00.000Z\",\"2011-01-11T23:00:00.000Z\",\"2011-01-12T00:00:00.000Z\",\"2011-01-12T01:00:00.000Z\",\"2011-01-12T02:00:00.000Z\",\"2011-01-12T05:00:00.000Z\",\"2011-01-12T06:00:00.000Z\",\"2011-01-12T07:00:00.000Z\",\"2011-01-12T08:00:00.000Z\",\"2011-01-12T09:00:00.000Z\",\"2011-01-12T10:00:00.000Z\",\"2011-01-12T11:00:00.000Z\",\"2011-01-12T12:00:00.000Z\",\"2011-01-12T13:00:00.000Z\",\"2011-01-12T14:00:00.000Z\",\"2011-01-12T15:00:00.000Z\",\"2011-01-12T16:00:00.000Z\",\"2011-01-12T17:00:00.000Z\",\"2011-01-12T18:00:00.000Z\",\"2011-01-12T19:00:00.000Z\",\"2011-01-12T20:00:00.000Z\",\"2011-01-12T21:00:00.000Z\",\"2011-01-12T22:00:00.000Z\",\"2011-01-12T23:00:00.000Z\",\"2011-01-13T00:00:00.000Z\",\"2011-01-13T01:00:00.000Z\",\"2011-01-13T02:00:00.000Z\",\"2011-01-13T03:00:00.000Z\",\"2011-01-13T04:00:00.000Z\",\"2011-01-13T05:00:00.000Z\",\"2011-01-13T06:00:00.000Z\",\"2011-01-13T07:00:00.000Z\",\"2011-01-13T08:00:00.000Z\",\"2011-01-13T09:00:00.000Z\",\"2011-01-13T10:00:00.000Z\",\"2011-01-13T11:00:00.000Z\",\"2011-01-13T12:00:00.000Z\",\"2011-01-13T13:00:00.000Z\",\"2011-01-13T14:00:00.000Z\",\"2011-01-13T15:00:00.000Z\",\"2011-01-13T16:00:00.000Z\",\"2011-01-13T17:00:00.000Z\",\"2011-01-13T18:00:00.000Z\",\"2011-01-13T19:00:00.000Z\",\"2011-01-13T20:00:00.000Z\",\"2011-01-13T21:00:00.000Z\",\"2011-01-13T22:00:00.000Z\"],[16,40,32,13,1,1,2,3,8,14,36,56,84,94,106,110,93,67,35,37,36,34,28,39,17,17,9,6,3,2,1,8,20,53,70,93,75,59,74,76,65,53,30,22,31,9,8,5,2,1,3,30,64,154,88,44,51,61,61,77,72,76,157,157,110,52,52,20,12,5,2,1,2,4,36,94,179,100,42,57,78,97,63,65,83,212,182,112,54,48,35,11,6,6,2,2,3,33,88,195,115,57,46,79,71,62,62,89,190,169,132,89,43,42,19,11,4,2,1,4,36,95,219,122,45,59,84,67,70,62,86,172,163,112,69,48,52,23,17,7,1,1,5,34,84,210,134,63,67,59,73,50,72,87,187,123,95,51,39,36,15,25,16,16,7,1,5,2,9,15,20,61,62,98,102,95,74,76,69,55,30,28,37,34,22,25,12,11,4,1,1,1,6,10,19,49,49,83,75,72,82,92,62,48,41,38,20,15,6,5,1,3,1,3,3,31,77,188,94,31,30,52,54,47,45,74,178,155,95,74,38,24,18,12,3,3,6,27,99,217,130,54,35,57,52,63,47,76,136,95,51,32,20,29,19,7,6,1,5,16,54,128,81,39,35,55,49,44,49,68,139,137,83,56,57,33,20,7,2,2,3,4,3,28,72,202,139,38,37,52,83,42,60,78,162,144,99,64,40,30]],\"fixedtz\":false,\"tzone\":\"UTC\",\"plugins\":{\"Crosshair\":{\"direction\":\"vertical\"}}},\"evals\":[\"attrs.interactionModel\"],\"jsHooks\":[]}</script>\n```\n\n\n交互式时间序列图：巴黎 Vélib 自行车租赁数据（前300条）\n:::\n:::\n\n\n## Base R\n\n### 基础\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 构造示例数据\na = c(1:5)                  # x 轴数据，1 到 5\nb = c(5, 3, 4, 5, 5)        # 第一组 y 轴数据\nc = c(4, 5, 4, 3, 1)        # 第二组 y 轴数据\n\n# 绘制第一组数据的连接散点图\nplot(\n    b ~ a,                    # y ~ x 公式\n    type = \"b\",               # 点和线都显示\n    bty = \"l\",                # 只显示左和下边框\n    xlab = \"value of a\",      # x 轴标签\n    ylab = \"value of b\",      # y 轴标签\n    col = rgb(0.2, 0.4, 0.1, 0.7), # 线和点的颜色（半透明绿色）\n    lwd = 3,                  # 线宽\n    pch = 17,                 # 点的形状（三角形）\n    ylim = c(1, 5)            # y 轴范围\n)\n\n# 添加第二组数据的连接散点图\nlines(\n    c ~ a,                    # y ~ x 公式\n    col = rgb(0.8, 0.4, 0.1, 0.7), # 线和点的颜色（半透明橙色）\n    lwd = 3,                  # 线宽\n    pch = 19,                 # 点的形状（实心圆）\n    type = \"b\"                # 点和线都显示\n)\n\n# 添加图例\nlegend(\n    \"bottomleft\",             # 图例位置\n    legend = c(\"Group 1\", \"Group 2\"), # 图例标签\n    col = c(\n        rgb(0.2, 0.4, 0.1, 0.7),\n        rgb(0.8, 0.4, 0.1, 0.7)\n    ),                        # 图例颜色\n    pch = c(17, 19),          # 图例点形状\n    bty = \"n\",                # 不显示图例边框\n    pt.cex = 2,               # 点的大小\n    cex = 1.2,                # 字体大小\n    text.col = \"black\",       # 文字颜色\n    horiz = FALSE,            # 垂直排列\n    inset = c(0.1, 0.1)       # 图例内边距\n)\n```\n\n::: {.cell-output-display}\n![基础 R 语言绘制连接散点图（两组数据）](connected-scatter_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n### 背景图\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 加载图片读取包\nlibrary(jpeg)\nlibrary(png)\n\n# 读取PNG图片作为背景\nmy_image <- readPNG(\"./image/R_full_medium.png\")\n\n# 设置空白绘图区，不画任何点\nplot(1:2, type='n', main=\"\", xlab=\"x\", ylab=\"y\")\n\n# 获取绘图区参数，并将图片填充到指定区域\nlim <- par()\nrasterImage(my_image, \n            xleft=1, xright=2, \n            ybottom=1.3, ytop=1.7)\n\n# 添加网格线\ngrid()\n\n# 在图片上添加连接散点图\nlines(\n  x=c(1, 1.2, 1.4, 1.6, 1.8, 2.0), \n  y=c(1, 1.3, 1.7, 1.6, 1.7, 1.0), \n  type=\"b\", lwd=5, col=\"black\"\n)\n```\n\n::: {.cell-output-display}\n![在背景图片上绘制连接散点图（基础R）](connected-scatter_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n### `lubridate()`\n\n使用日期前，务必使用 `lubridate()` 把 “日期” 转化为 日期/时间格式。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 设置随机种子，保证结果可复现\nset.seed(124)\n\n# 构造日期字符串，格式为 \"2015/03/XX\"，XX为1到31中的随机6个数字\ndate <- paste(\"2015/03/\", sample(seq(1, 31), 6), sep = \"\")\n\n# 随机生成6个1到100之间的整数，作为数值\nvalue <- sample(seq(1, 100), 6)\n\n# 将日期和数值合并为数据框\ndata <- data.frame(date, value)\n\n# 将日期列转换为 Date 类型，便于后续处理和绘图\ndata$date <- as.Date(data$date)\n\n# 按照日期升序排列数据\ndata <- data[order(data$date), ]\n\n# 绘制连接散点图\nplot(\n    data$value ~ data$date,                 # y轴为value，x轴为date\n    type = \"b\",                             # 同时绘制点和线\n    lwd = 3,                                # 线宽为3\n    col = rgb(0.1, 0.7, 0.1, 0.8),          # 线和点的颜色（半透明绿色）\n    ylab = \"value of ...\",                  # y轴标签\n    xlab = \"date\",                          # x轴标签\n    bty = \"l\",                              # 只显示左和下边框\n    pch = 20,                               # 点的形状（实心圆）\n    cex = 4                                 # 点的大小\n)\n\n# 添加水平辅助线，y轴从0到100，每隔10画一条灰色线\nabline(h = seq(0, 100, 10), col = \"grey\", lwd = 0.8)\n```\n\n::: {.cell-output-display}\n![使用 lubridate() 处理日期时间](connected-scatter_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n### Cheatsheet\n\nBase R 提供了许多选项来自定义图表外观。基本上所有功能都可以通过这几个选项实现：\n\n- `lwd` → 线条宽度\n- `type` → 点之间的连接\n- `lty` → 线条类型\n- `cex` → 形状大小\n- `col` → 控制颜色\n- `pch` → 标记形状\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 设置绘图区边距\npar(mar = c(3, 3, 3, 3))\n\nnum <- 0   # 用于lty编号\nnum1 <- 0  # 用于type和lwd编号\n\n# 创建空白绘图区，不显示任何点\nplot(\n  0, 0,\n  xlim = c(0, 21),           # x轴范围\n  ylim = c(0.5, 6.5),        # y轴范围\n  col = \"white\",             # 不显示点\n  yaxt = \"n\",                # 不显示y轴刻度\n  ylab = \"\",                 # y轴标签为空\n  xlab = \"\"                  # x轴标签为空\n)\n\n# 填充图形各行，分别演示不同参数\nfor (i in seq(1, 20)) {\n  # 第一行：pch（点的形状）\n  points(i, 1, pch = i, cex = 3)\n  # 第二行：col（颜色）\n  points(i, 2, col = i, pch = 16, cex = 3)\n  # 第三行：cex（点的大小）\n  points(i, 3, col = \"black\", pch = 16, cex = i * 0.25)\n\n  # 第四行：lty（线型），每隔3个画一条线\n  if (i %in% c(seq(1, 18, 3))) {\n    num = num + 1\n    points(c(i, i + 2), c(4, 4), col = \"black\", lty = num, type = \"l\", lwd = 2)\n    text(i + 1.1, 4.15, num)  # 标注lty编号\n  }\n\n  # 第五、六行：type（线型类型）和lwd（线宽），每隔5个画一组\n  if (i %in% c(seq(1, 20, 5))) {\n    num1 = num1 + 1\n    # type参数演示（点、线、点线、点线重叠）\n    points(\n      c(i, i + 1, i + 2, i + 3),\n      c(5, 5, 5, 5),\n      col = \"black\",\n      type = c(\"p\", \"l\", \"b\", \"o\")[num1],\n      lwd = 2\n    )\n    text(i + 1.1, 5.2, c(\"p\", \"l\", \"b\", \"o\")[num1])  # 标注type类型\n\n    # lwd参数演示（线宽1~4）\n    points(\n      c(i, i + 1, i + 2, i + 3),\n      c(6, 6, 6, 6),\n      col = \"black\",\n      type = \"l\",\n      lwd = num1\n    )\n    text(i + 1.1, 6.2, num1)  # 标注lwd数值\n  }\n}\n\n# 添加y轴标签，分别对应各参数\naxis(\n  2,\n  at = c(1, 2, 3, 4, 5, 6),\n  labels = c(\"pch\", \"col\", \"cex\", \"lty\", \"type\", \"lwd\"),\n  tick = TRUE,\n  col = \"black\",\n  las = 1,\n  cex.axis = 0.8\n)\n\n# 添加x轴标签，1~20\naxis(\n  1,\n  at = seq(1, 20),\n  labels = seq(1, 20),\n  tick = TRUE,\n  col = \"black\",\n  las = 1,\n  cex.axis = 0.8\n)\n```\n\n::: {.cell-output-display}\n![Base R 图形参数速查表：pch, col, cex, lty, type, lwd 的效果演示](connected-scatter_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n## Pearl\n\n带有文字标签的散点图，见 @sec-label-pearl。\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<script src=\"site_libs/jquery-1.11.1/jquery.min.js\"></script>\n<link href=\"site_libs/dygraphs-1.1.1/dygraph.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/dygraphs-1.1.1/dygraph-combined.js\"></script>\n<script src=\"site_libs/dygraphs-1.1.1/shapes.js\"></script>\n<script src=\"site_libs/moment-2.8.4/moment.js\"></script>\n<script src=\"site_libs/moment-timezone-0.2.5/moment-timezone-with-data.js\"></script>\n<script src=\"site_libs/moment-fquarter-1.0.0/moment-fquarter.min.js\"></script>\n<script src=\"site_libs/dygraphs-binding-1.1.1.6/dygraphs.js\"></script>\n<script src=\"site_libs/Dygraph.Plugins.Crosshair-1.0/crosshair.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}