{
  "hash": "24078a920af66de893e6f0c1e28c0a6c",
  "result": {
    "engine": "knitr",
    "markdown": "# Spider {#sec-spider}\n\n蛛网图, 又称雷达图. 缺点不少, 在数据科学领域不推荐使用.\n\n## PKG\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(fmsb) # 用于绘制雷达图\nlibrary(RColorBrewer) # 用于生成颜色\nlibrary(scales)         # 用于设置透明度\nlibrary(tidyverse)      # 用于数据处理和可视化\nlibrary(hrbrthemes)     # 用于美化图表主题\nlibrary(colormap)      # 用于生成颜色映射\nlibrary(GGally)       # 用于绘制平行坐标图\nlibrary(viridis)      # 用于生成颜色映射\n# remotes::install_github(\"ricardo-bion/ggradar\")\nlibrary(ggradar)     # 用于绘制雷达图\nlibrary(palmerpenguins) # 用于示例企鹅数据集\nlibrary(scales)  # 用于设置透明度\nlibrary(showtext) # 用于加载字体\nshowtext_auto() # 自动加载字体\n```\n:::\n\n\n## 问题\n\n- 圆形布局 = 更难阅读\n- 不支持排名\n- 类别顺序影响巨大: 同样的数据不同的排序,形状差别巨大\n- 刻度不自由: 直观上 各类别的刻度应该是一样的, 设置每个类别的刻度不同, 会导致误解\n- 重叠绘图: 过多观测时不好展示\n- 过度评估差异: 雷达图中形状的面积也会以平方而非线性的方式增加，看起来差异比实际更显著\n\n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\n# 设置随机种子，保证结果可复现\nset.seed(1)\n\n# 生成一个包含10个科目的数据框，每个科目随机生成一个2到20之间的整数\ndata <- as.data.frame(matrix(sample(2:20, 10, replace = TRUE), ncol = 10))\n\n# 设置列名为各个科目\ncolnames(data) <- c(\n    \"math\",        # 数学\n    \"english\",     # 英语\n    \"biology\",     # 生物\n    \"music\",       # 音乐\n    \"R-coding\",    # R编程\n    \"data-viz\",    # 数据可视化\n    \"french\",      # 法语\n    \"physic\",      # 物理\n    \"statistic\",   # 统计\n    \"sport\"        # 体育\n)\n\n# 为了使用fmsb包绘制雷达图，需要在数据框前面添加最大值和最小值两行\ndata <- rbind(rep(20, 10), rep(0, 10), data)\n\n# 自定义雷达图\npar(mar = c(0, 0, 0, 0)) # 设置画布边距\nradarchart(\n    data,                # 输入数据\n    axistype = 1,        # 坐标轴类型\n\n    # 自定义多边形\n    pcol = rgb(0.2, 0.5, 0.5, 0.9),   # 多边形边框颜色\n    pfcol = rgb(0.2, 0.5, 0.5, 0.5),  # 多边形填充颜色\n    plwd = 4,                         # 多边形边框线宽\n\n    # 自定义网格\n    cglcol = \"grey\",                  # 网格线颜色\n    cglty = 1,                        # 网格线类型\n    axislabcol = \"grey\",              # 轴标签颜色\n    caxislabels = seq(0, 20, 5),      # 轴标签内容\n    cglwd = 0.8,                      # 网格线宽\n\n    # 自定义标签\n    vlcex = 1.3                       # 变量标签字体大小\n)\n\n# 条形图：展示同一组数据的分布，更易于比较\ndata |>\n    slice(3) |>                         # 选取第三行（即实际数据，前两行为最大最小值）\n    t() |>                              # 转置数据框，方便后续处理\n    as.data.frame() |>                  # 转换为数据框\n    tibble::rownames_to_column() |>     # 将行名（科目名）转为一列\n    arrange(V1) |>                      # 按分数升序排列\n    mutate(rowname = factor(rowname, rowname)) |> # 保持原有顺序\n    ggplot(aes(x = rowname, y = V1)) +  # 绘图，x轴为科目，y轴为分数\n    geom_segment(\n        aes(x = rowname, xend = rowname, y = 0, yend = V1),\n        color = \"grey\"                    # 绘制灰色线段\n    ) +\n    geom_point(size = 5, color = \"#69b3a2\") + # 绘制数据点\n    coord_flip() +                            # 翻转坐标轴，横向展示\n    theme_ipsum() +                           # 使用hrbrthemes包的主题\n    theme(\n        panel.grid.minor.y = element_blank(),   # 去除y轴次网格线\n        panel.grid.major.y = element_blank(),   # 去除y轴主网格线\n        axis.text = element_text(size = 48),    # 设置坐标轴文字大小\n        legend.position = \"none\"                # 不显示图例\n    ) +\n    ylim(0, 20) +                             # 设置y轴范围\n    ylab(\"mark\") +                            # y轴标签\n    xlab(\"\")                                  # x轴标签为空\n```\n\n::: {.cell-output-display}\n![左：雷达图；](spider_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![右：棒棒糖图](spider_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n\n雷达图不如棒棒糖直观\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 创建数据：Jonathan在高中各科的成绩\nset.seed(7)\ndata <- as.data.frame(matrix(sample(2:20, 10, replace = TRUE), ncol = 10))\ncolnames(data) <- c(\n    \"math\",        # 数学\n    \"english\",     # 英语\n    \"biology\",     # 生物\n    \"music\",       # 音乐\n    \"R-coding\",    # R编程\n    \"data-viz\",    # 数据可视化\n    \"french\",      # 法语\n    \"physic\",      # 物理\n    \"statistic\",   # 统计\n    \"sport\"        # 体育\n)\n# 将前三门科目的成绩设为19，6~8门成绩设为4，突出差异\ndata[1, 1:3] <- rep(19, 3)\ndata[1, 6:8] <- rep(4, 3)\n# 按fmsb包要求，前两行为最大值和最小值\ndata <- rbind(rep(20, 10), rep(0, 10), data)\n\n# 改变类别顺序，生成两组不同顺序的数据\ndata2 <- data[, sample(1:10, 10, replace = FALSE)]\ndata3 <- data[, sample(1:10, 10, replace = FALSE)]\n\n# 自定义雷达图，展示同一组数据在不同类别顺序下的形状变化\npar(mar = c(0, 0, 0, 0))      # 设置画布边距为0\npar(mfrow = c(1, 3))          # 一行三列布局，便于对比\n\n# 绘制第一组类别顺序的雷达图\nradarchart(\n    data,                       # 输入数据\n    axistype = 1,               # 坐标轴类型\n    pcol = rgb(0.2, 0.5, 0.5, 0.9),   # 多边形边框颜色\n    pfcol = rgb(0.2, 0.5, 0.5, 0.5),  # 多边形填充颜色\n    plwd = 4,                   # 多边形边框线宽\n    cglcol = \"grey\",            # 网格线颜色\n    cglty = 1,                  # 网格线类型\n    axislabcol = \"grey\",        # 轴标签颜色\n    caxislabels = seq(0, 20, 5),# 轴标签内容\n    cglwd = 0.8,                # 网格线宽\n    vlcex = 0.8                 # 变量标签字体大小\n)\n\n# 绘制第二组类别顺序的雷达图\nradarchart(\n    data2,                      # 输入数据（类别顺序已打乱）\n    axistype = 1,\n    pcol = rgb(0.2, 0.5, 0.5, 0.9),\n    pfcol = rgb(0.2, 0.5, 0.5, 0.5),\n    plwd = 4,\n    cglcol = \"grey\",\n    cglty = 1,\n    axislabcol = \"grey\",\n    caxislabels = seq(0, 20, 5),\n    cglwd = 0.8,\n    vlcex = 0.8\n)\n\n# 绘制第三组类别顺序的雷达图\nradarchart(\n    data3,                      # 输入数据（类别顺序再次打乱）\n    axistype = 1,\n    pcol = rgb(0.2, 0.5, 0.5, 0.9),\n    pfcol = rgb(0.2, 0.5, 0.5, 0.5),\n    plwd = 4,\n    cglcol = \"grey\",\n    cglty = 1,\n    axislabcol = \"grey\",\n    caxislabels = seq(0, 20, 5),\n    cglwd = 0.8,\n    vlcex = 0.8\n)\n```\n\n::: {.cell-output-display}\n![类别顺序影响雷达图形状：同一组数据，不同类别顺序，形状差异巨大](spider_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\npar(mfrow = c(1, 1)) # 重置布局\n```\n:::\n\n\n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\n# 生成一个包含5个科目的数据框，每个科目分数均为7\ndata <- as.data.frame(matrix(c(7, 7, 7, 7, 7), ncol = 5))\n\n# 设置列名为各个科目\ncolnames(data) <- c(\"math\", \"english\", \"biology\", \"music\", \"R-coding\")\n\n# fmsb包要求数据框前两行为最大值和最小值，这里最大值为20，最小值为0\ndata <- rbind(rep(20, 5), rep(0, 5), data)\n\n# 复制一份数据，作为第二组数据\ndata2 <- data\n# 修改第三行（即实际数据），将分数全部设为14\ndata2[3, ] <- rep(14, 5)\n\n# 设置画布边距为0，避免图形被裁剪\npar(mar = rep(0, 4))\n\n# 绘制第一组数据的雷达图\nradarchart(\n    data,                   # 输入数据\n    axistype = 1,           # 坐标轴类型\n    pcol = rgb(0.2, 0.5, 0.5, 0.9),   # 多边形边框颜色\n    pfcol = rgb(0.2, 0.5, 0.5, 0.5),  # 多边形填充颜色\n    plwd = 4,               # 多边形边框线宽\n    cglcol = \"grey\",        # 网格线颜色\n    cglty = 1,              # 网格线类型\n    axislabcol = \"grey\",    # 轴标签颜色\n    caxislabels = seq(0, 20, 5), # 轴标签内容\n    cglwd = 0.8,            # 网格线宽\n    vlcex = 0.8             # 变量标签字体大小\n)\n\n# 绘制第二组数据的雷达图\nradarchart(\n    data2,                  # 输入数据\n    axistype = 1,           # 坐标轴类型\n    pcol = rgb(0.2, 0.5, 0.5, 0.9),   # 多边形边框颜色\n    pfcol = rgb(0.2, 0.5, 0.5, 0.5),  # 多边形填充颜色\n    plwd = 4,               # 多边形边框线宽\n    cglcol = \"grey\",        # 网格线颜色\n    cglty = 1,              # 网格线类型\n    axislabcol = \"grey\",    # 轴标签颜色\n    caxislabels = seq(0, 20, 5), # 轴标签内容\n    cglwd = 0.8,            # 网格线宽\n    vlcex = 0.8             # 变量标签字体大小\n)\n```\n\n::: {.cell-output-display}\n![左：所有科目分数均为7；](spider_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![右：所有科目分数均为14。](spider_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n\n雷达图过度评估了差距\n:::\n\n  \n## 改进\n\n如果刻度相同, 可以使用条形图、棒棒糖图(吸管图)代替雷达图, 并进行排序\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 设置随机种子，保证结果可复现\nset.seed(1)\n\n# 生成一个包含10个科目的数据框，每个科目随机生成一个2到20之间的整数\ndata <- as.data.frame(matrix(sample(2:20, 10, replace = TRUE), ncol = 10))\n\n# 设置列名为各个科目\ncolnames(data) <- c(\n    \"math\",        # 数学\n    \"english\",     # 英语\n    \"biology\",     # 生物\n    \"music\",       # 音乐\n    \"R-coding\",    # R编程\n    \"data-viz\",    # 数据可视化\n    \"french\",      # 法语\n    \"physic\",      # 物理\n    \"statistic\",   # 统计\n    \"sport\"        # 体育\n)\n\n# 为了与雷达图数据结构一致，前两行为最大值和最小值\ndata <- rbind(rep(20, 10), rep(0, 10), data)\n\n# 棒棒糖图：展示同一组数据的分布，更易于比较\ndata |>\n    slice(3) |>                         # 选取第三行（即实际数据，前两行为最大最小值）\n    t() |>                              # 转置数据框，方便后续处理\n    as.data.frame() |>                  # 转换为数据框\n    tibble::rownames_to_column() |>     # 将行名（科目名）转为一列\n    arrange(V1) |>                      # 按分数升序排列\n    mutate(rowname = factor(rowname, rowname)) |> # 保持原有顺序\n    ggplot(aes(x = rowname, y = V1)) +  # 绘图，x轴为科目，y轴为分数\n    geom_segment(\n        aes(x = rowname, xend = rowname, y = 0, yend = V1),\n        color = \"grey\"                    # 绘制灰色线段\n    ) +\n    geom_point(size = 5, color = \"#69b3a2\") + # 绘制数据点\n    coord_flip() +                            # 翻转坐标轴，横向展示\n    theme_ipsum() +                           # 使用hrbrthemes包的主题\n    theme(\n        panel.grid.minor.y = element_blank(),   # 去除y轴次网格线\n        panel.grid.major.y = element_blank(),   # 去除y轴主网格线\n        axis.text = element_text(size = 48),    # 设置坐标轴文字大小\n        legend.position = \"none\"                # 不显示图例\n    ) +\n    ylim(0, 20) +                             # 设置y轴范围\n    ylab(\"mark\") +                            # y轴标签\n    xlab(\"\")                                  # x轴标签为空\n```\n\n::: {.cell-output-display}\n![棒棒糖图：同一组数据的分数分布，更易于比较](spider_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n两个观测进行对比(哑铃图), 设置颜色或透明度来区分两组:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 设置随机种子，保证结果可复现\nset.seed(1)\n\n# 生成一个包含10个科目的数据框，每个科目随机生成一个2到20之间的整数，共两组观测\ndata <- as.data.frame(matrix(sample(2:20, 20, replace = TRUE), ncol = 10))\n\n# 设置列名为各个科目\ncolnames(data) <- c(\n    \"math\",        # 数学\n    \"english\",     # 英语\n    \"biology\",     # 生物\n    \"music\",       # 音乐\n    \"R-coding\",    # R编程\n    \"data-viz\",    # 数据可视化\n    \"french\",      # 法语\n    \"physic\",      # 物理\n    \"statistic\",   # 统计\n    \"sport\"        # 体育\n)\n\n# 为了与雷达图数据结构一致，前两行为最大值和最小值\ndata <- rbind(rep(20, 10), rep(0, 10), data)\n\n# 哑铃图：对比两组观测在各科目的分数差异\ndata |>\n    slice(c(3, 4)) |>                         # 选取第三、四行（即两组实际观测数据）\n    t() |>                                    # 转置数据框，方便后续处理\n    as.data.frame() |>                        # 转换为数据框\n    tibble::rownames_to_column() |>           # 将行名（科目名）转为一列\n    arrange(V1) |>                            # 按第一组分数升序排列\n    mutate(rowname = factor(rowname, rowname)) |> # 保持原有顺序\n    ggplot(aes(x = rowname, y = V1)) +        # 绘图，x轴为科目，y轴为第一组分数\n    geom_segment(\n        aes(x = rowname, xend = rowname, y = V2, yend = V1),\n        color = \"grey\"                        # 绘制两组分数之间的线段\n    ) +\n    geom_point(size = 5, color = \"#69b3a2\") + # 绘制第一组分数的数据点\n    geom_point(aes(y = V2), size = 5, color = \"#69b3a2\", alpha = 0.5) + # 绘制第二组分数的数据点（透明）\n    coord_flip() +                            # 翻转坐标轴，横向展示\n    theme_ipsum() +                           # 使用hrbrthemes包的主题\n    theme(\n        panel.grid.minor.y = element_blank(),   # 去除y轴次网格线\n        panel.grid.major.y = element_blank(),   # 去除y轴主网格线\n        axis.text = element_text(size = 48)     # 设置坐标轴文字大小\n    ) +\n    ylim(0, 20) +                             # 设置y轴范围\n    ylab(\"mark\") +                            # y轴标签\n    xlab(\"\")                                  # x轴标签为空\n```\n\n::: {.cell-output-display}\n![哑铃图：对比两组观测在各科目的分数差异](spider_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n观测很多考虑分面:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 设置随机种子，保证结果可复现\nset.seed(1)\n\n# 生成一个包含4位同学、10个科目的数据框，每个科目随机生成一个2到20之间的整数\ndata <- as.data.frame(matrix(sample(2:20, 40, replace = TRUE), ncol = 10))\n\n# 设置列名为各个科目\ncolnames(data) <- c(\n    \"math\",        # 数学\n    \"english\",     # 英语\n    \"biology\",     # 生物\n    \"music\",       # 音乐\n    \"R-coding\",    # R编程\n    \"data-viz\",    # 数据可视化\n    \"french\",      # 法语\n    \"physic\",      # 物理\n    \"statistic\",   # 统计\n    \"sport\"        # 体育\n)\n\n# 为了使用fmsb包绘制雷达图，需要在数据框前面添加最大值和最小值两行\ndata <- rbind(rep(20, 10), rep(0, 10), data)\n\n# 设置行名为4位同学\nrownames(data) <- c(\"-\", \"--\", \"John\", \"Angli\", \"Baptiste\", \"Alfred\")\n\n# 数据整理：选取4位同学的数据，转置后整理为长格式，便于ggplot分面绘图\ndata |>\n    slice(3:6) |>                        # 选取第3到第6行（4位同学的成绩）\n    t() |>                               # 转置数据框，行变为科目，列为同学\n    as.data.frame() |>                   # 转换为数据框\n    tibble::rownames_to_column() |>      # 将行名（科目名）转为一列\n    tidyr::gather(key = name, value = mark, -rowname) |> # 宽数据转为长数据\n    mutate(\n        # 重编码同学姓名，便于分面标签美观\n        name = dplyr::recode(\n            name,\n            V1 = \"John\",\n            V2 = \"Angli\",\n            V3 = \"Baptiste\",\n            V4 = \"Alfred\"\n        ),\n        # 保持科目顺序\n        # rowname = factor(rowname, rowname)\n    ) |>\n    # 绘图：分面棒棒糖图\n    ggplot(aes(x = rowname, y = mark)) +\n    geom_bar(stat = \"identity\", fill = \"#69b3a2\", width = 0.6) + # 绘制条形\n    coord_flip() +                                               # 翻转坐标轴，横向展示\n    theme_ipsum() +                                              # 使用hrbrthemes包的主题\n    theme(\n        panel.grid.minor.y = element_blank(),   # 去除y轴次网格线\n        panel.grid.major.y = element_blank(),   # 去除y轴主网格线\n        axis.text = element_text(size = 48)     # 设置坐标轴文字大小\n    ) +\n    ylim(0, 20) +                             # 设置y轴范围\n    ylab(\"mark\") +                            # y轴标签\n    xlab(\"\") +                                # x轴标签为空\n    facet_wrap(~name, ncol = 4)               # 按同学分面展示，每行4个分面\n```\n\n::: {.cell-output-display}\n![分面棒棒糖图：多位同学各科成绩分布对比](spider_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n多系列且不同刻度:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 加载GGally包用于平行坐标图\nlibrary(GGally)\n# 加载示例数据集iris\ndata <- iris\n\n# 使用ggparcoord绘制平行坐标图\ndata |>\n    ggparcoord(\n        columns = 1:4,           # 选择前4列（花萼长度、花萼宽度、花瓣长度、花瓣宽度）\n        groupColumn = 5,         # 按第5列（Species，花的种类）分组上色\n        order = \"anyClass\",      # 变量顺序自动排列\n        showPoints = TRUE,       # 显示每个观测点\n        title = \"Parallel Coordinate Plot for the Iris Data\", # 图标题\n        alphaLines = 0.3         # 线条透明度\n    ) +\n    scale_color_viridis(discrete = TRUE) + # 使用viridis配色方案\n    theme_ipsum()                          # 使用hrbrthemes包的美化主题\n```\n\n::: {.cell-output-display}\n![鸢尾花数据集的平行坐标图：不同种类的花在各特征上的分布对比](spider_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n## 单组\n\n### 基本\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 生成一个包含10个科目的数据框，每个科目随机生成一个2到20之间的整数\ndata <- matrix(sample(2:20, 10, replace = TRUE), ncol = 10) |>\n    as.data.frame()\n\n# 设置列名为各个科目\ncolnames(data) <- c(\n    \"math\",        # 数学\n    \"english\",     # 英语\n    \"biology\",     # 生物\n    \"music\",       # 音乐\n    \"R-coding\",    # R编程\n    \"data-viz\",    # 数据可视化\n    \"french\",      # 法语\n    \"physic\",      # 物理\n    \"statistic\",   # 统计\n    \"sport\"        # 体育\n)\n\n# 为了使用fmsb包绘制雷达图，需要在数据框前面添加最大值和最小值两行\ndata <- rbind(rep(20, 10), rep(0, 10), data)\n\n# 检查数据格式是否正确\n# head(data)\n\n# 绘制默认的雷达图\nradarchart(data)\n```\n\n::: {.cell-output-display}\n![基本雷达图](spider_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n### 定制\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 使用 radarchart 绘制定制雷达图\nradarchart(\n    data,                # 输入数据\n    axistype = 1,        # 坐标轴类型\n\n    # 自定义多边形\n    pcol = rgb(0.2, 0.5, 0.5, 0.9),   # 多边形边框颜色\n    pfcol = rgb(0.2, 0.5, 0.5, 0.5),  # 多边形填充颜色\n    plwd = 4,                         # 多边形边框线宽\n\n    # 自定义网格\n    cglcol = \"grey\",                  # 网格线颜色\n    cglty = 1,                        # 网格线类型\n    axislabcol = \"grey\",              # 轴标签颜色\n    caxislabels = seq(0, 20, 5),      # 轴标签内容\n    cglwd = 0.8,                      # 网格线宽\n\n    # 自定义标签\n    vlcex = 0.8                       # 变量标签字体大小\n)\n```\n\n::: {.cell-output-display}\n![定制雷达图：自定义多边形颜色、线宽、网格和标签](spider_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n## 多组\n\n### 基本\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 设置随机种子，保证结果可复现\nset.seed(99)\n\n# 生成一个3行5列的数据框，表示3位同学在5个科目的分数（0~20之间不重复的整数）\ndata <- matrix(sample(0:20, 15, replace = FALSE), ncol = 5) |>\n    as.data.frame()\n\n# 设置列名为各个科目\ncolnames(data) <- c(\"math\", \"english\", \"biology\", \"music\", \"R-coding\")\n\n# 设置行名为三位同学\nrownames(data) <- paste(\"mister\", letters[1:3], sep = \"-\")\n\n# fmsb包要求数据框前两行为最大值和最小值\ndata <- rbind(rep(20, 5), rep(0, 5), data)\n\n# 绘制多组雷达图，展示三位同学的成绩分布\nradarchart(data)\n```\n\n::: {.cell-output-display}\n![多组雷达图：展示三位同学在五个科目的表现](spider_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n### 定制\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 定义多边形边框颜色向量\ncolors_border <- c(\n    rgb(0.2, 0.5, 0.5, 0.9),  # 第一位同学的边框颜色\n    rgb(0.8, 0.2, 0.5, 0.9),  # 第二位同学的边框颜色\n    rgb(0.7, 0.5, 0.1, 0.9)   # 第三位同学的边框颜色\n)\n\n# 定义多边形填充颜色向量\ncolors_in <- c(\n    rgb(0.2, 0.5, 0.5, 0.4),  # 第一位同学的填充颜色\n    rgb(0.8, 0.2, 0.5, 0.4),  # 第二位同学的填充颜色\n    rgb(0.7, 0.5, 0.1, 0.4)   # 第三位同学的填充颜色\n)\n\n# 绘制定制多组雷达图\nradarchart(\n    data,                # 输入数据\n    axistype = 1,        # 坐标轴类型\n\n    # 自定义多边形\n    pcol = colors_border,    # 多边形边框颜色\n    pfcol = colors_in,       # 多边形填充颜色\n    plwd = 4,                # 多边形边框线宽\n    plty = 1,                # 多边形线型\n\n    # 自定义网格\n    cglcol = \"grey\",         # 网格线颜色\n    cglty = 1,               # 网格线类型\n    axislabcol = \"grey\",     # 轴标签颜色\n    caxislabels = seq(0, 20, 5), # 轴标签内容\n    cglwd = 0.8,             # 网格线宽\n\n    # 自定义标签\n    vlcex = 0.8              # 变量标签字体大小\n)\n\n# 添加图例，标注每位同学对应的颜色\nlegend(\n    x = 0.7,                             # 图例x坐标\n    y = 1,                               # 图例y坐标\n    legend = rownames(data[-c(1, 2), ]), # 图例标签（去除最大最小值行）\n    bty = \"n\",                           # 无边框\n    pch = 20,                            # 图例点类型\n    col = colors_in,                     # 图例点颜色\n    text.col = \"grey\",                   # 图例文字颜色\n    cex = 1.2,                           # 图例字体大小\n    pt.cex = 3                           # 图例点大小\n)\n```\n\n::: {.cell-output-display}\n![定制多组雷达图：不同颜色区分三位同学的成绩，并添加图例](spider_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\n### 坐标轴\n\n如果没有输入坐标轴最大值和最小值, 则会自动计算.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 设置随机种子，保证结果可复现\nset.seed(99)\n\n# 生成一个3行5列的数据框，表示3位同学在5个科目的分数（0~20之间不重复的整数）\ndata <- matrix(sample(0:20, 15, replace = FALSE), ncol = 5) |>\n    as.data.frame()\n\n# 设置列名为各个科目\ncolnames(data) <- c(\"math\", \"english\", \"biology\", \"music\", \"R-coding\")\n\n# 设置行名为三位同学\nrownames(data) <- paste(\"mister\", letters[1:3], sep = \"-\")\n\n# 生成配色方案\ncoul <- brewer.pal(3, \"BuPu\")      # 选取3种颜色\ncolors_border <- coul              # 多边形边框颜色\ncolors_in <- alpha(coul, 0.3)      # 多边形填充颜色，带透明度\n\n# 不添加最大最小值行，radarchart会自动根据数据计算坐标轴范围\nradarchart(\n    data,                # 输入数据（不含最大最小值行）\n    axistype = 0,        # 坐标轴类型\n    maxmin = FALSE,      # 不手动指定最大最小值，自动计算\n\n    # 自定义多边形\n    pcol = colors_border,    # 多边形边框颜色\n    pfcol = colors_in,       # 多边形填充颜色\n    plwd = 4,                # 多边形边框线宽\n    plty = 1,                # 多边形线型\n\n    # 自定义网格\n    cglcol = \"grey\",         # 网格线颜色\n    cglty = 1,               # 网格线类型\n    axislabcol = \"black\",    # 轴标签颜色\n    cglwd = 0.8,             # 网格线宽\n\n    # 自定义标签\n    vlcex = 0.8              # 变量标签字体大小\n)\n\n# 添加图例，标注每位同学对应的颜色\nlegend(\n    x = 0.7,                             # 图例x坐标\n    y = 1,                               # 图例y坐标\n    legend = rownames(data),             # 图例标签\n    bty = \"n\",                           # 无边框\n    pch = 20,                            # 图例点类型\n    col = colors_in,                     # 图例点颜色\n    text.col = \"grey\",                   # 图例文字颜色\n    cex = 1.2,                           # 图例字体大小\n    pt.cex = 3                           # 图例点大小\n)\n```\n\n::: {.cell-output-display}\n![自动计算坐标轴范围的雷达图：不手动输入最大最小值](spider_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n## 超多组\n\n不建议放到一个图中, 但可以分面展示(不是ggplot 分面语法): \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 设置随机种子，保证结果可复现\nset.seed(1)\n\n# 生成一个6行10列的数据框，表示6位同学在10个科目的分数（2~20之间可重复）\ndata <- matrix(\n    sample(2:20, 60, replace = TRUE), # 随机生成60个2~20之间的整数\n    ncol = 10,                        # 每行10个科目\n    byrow = TRUE                      # 按行填充\n) |> \n    as.data.frame()                   # 转换为数据框\n\n# 设置列名为各个科目\ncolnames(data) <- c(\n    \"math\",        # 数学\n    \"english\",     # 英语\n    \"biology\",     # 生物\n    \"music\",       # 音乐\n    \"R-coding\",    # R编程\n    \"data-viz\",    # 数据可视化\n    \"french\",      # 法语\n    \"physic\",      # 物理\n    \"statistic\",   # 统计\n    \"sport\"        # 体育\n)\n\n# fmsb包要求数据框前两行为最大值和最小值\ndata <- rbind(rep(20, 10), rep(0, 10), data)\n\n# 生成配色方案，6种颜色\ncolors_border <- colormap(colormap = colormaps$viridis, nshades = 6, alpha = 1)\ncolors_in <- colormap(colormap = colormaps$viridis, nshades = 6, alpha = 0.3)\n\n# 设置每个子图的标题\nmytitle <- c(\"Max\", \"George\", \"Xue\", \"Tom\", \"Alice\", \"bob\")\n\n# 设置画布边距\npar(mar = rep(0.8, 4))\n# 将画布分为2行3列，准备绘制6个子图\npar(mfrow = c(2, 3))\n\n# 循环绘制每位同学的雷达图\nfor (i in 1:6) {\n    radarchart(\n        data[c(1, 2, i + 2), ],   # 选取最大值、最小值和第i位同学的数据\n        axistype = 1,             # 坐标轴类型\n\n        # 多边形样式\n        pcol = colors_border[i],  # 多边形边框颜色\n        pfcol = colors_in[i],     # 多边形填充颜色\n        plwd = 4,                 # 多边形边框线宽\n        plty = 1,                 # 多边形线型\n\n        # 网格样式\n        cglcol = \"grey\",          # 网格线颜色\n        cglty = 1,                # 网格线类型\n        axislabcol = \"grey\",      # 轴标签颜色\n        caxislabels = seq(0, 20, 5), # 轴标签内容\n        cglwd = 0.8,              # 网格线宽\n\n        # 标签样式\n        vlcex = 0.8,              # 变量标签字体大小\n\n        # 子图标题\n        title = mytitle[i]\n    )\n}\n```\n\n::: {.cell-output-display}\n![超多组雷达图：6位同学各自成绩的雷达图分面展示](spider_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# 恢复默认的画布设置\npar(mfrow = c(1, 1))\n```\n:::\n\n\n## `ggradar`\n\n首先准备数据:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 加载palmerpenguins数据集\ndata(\"penguins\", package = \"palmerpenguins\")\n\n# 数据整理：去除缺失值，按species分组，计算各特征均值，并标准化到[0,1]区间\npenguins_radar <- penguins |>\n    drop_na() |>\n    group_by(species) |>\n    summarise(\n        avg_bill_length = mean(bill_length_mm),   # 喙长均值\n        avg_bill_dept = mean(bill_depth_mm),      # 喙深均值\n        avg_flipper_length = mean(flipper_length_mm), # 翼长均值\n        avg_body_mass = mean(body_mass_g)         # 体重均值\n    ) |>\n    ungroup() |>\n    mutate(across(-species, rescale))           # 除species外所有列标准化到[0,1]\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 使用ggradar包绘制企鹅三种类在各特征上的标准化均值雷达图\nplt <- penguins_radar |> ggradar()\nplt\n```\n\n::: {.cell-output-display}\n![企鹅三种类在各特征上的标准化均值雷达图（ggradar）](spider_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 对ggradar绘图对象进行美化，调整图例位置、字体和背景\nplt <- plt + \n  theme(\n    legend.position = c(0.85, 0.1),   # 图例位置\n    legend.text = element_text(size = 28), # 图例文字大小\n    legend.key = element_rect(fill = NA, color = NA), # 图例键背景\n    legend.background = element_blank() # 图例背景\n  )\nplt\n```\n\n::: {.cell-output-display}\n![美化后的企鹅三种类标准化均值雷达图（ggradar）](spider_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplt <- plt + \n  labs(title = \"Radar plot of penguins species\") + \n  theme(\n      plot.background = element_rect(fill = \"#fbf9f4\", color = \"#fbf9f4\"),\n      panel.background = element_rect(fill = \"#fbf9f4\", color = \"#fbf9f4\"),\n      plot.title.position = \"plot\", # slightly different from default\n      plot.title = element_text(\n        family = \"lobstertwo\", \n        size = 62,\n        face = \"bold\", \n        color = \"#2a475e\"\n    )\n  )\nplt\n```\n\n::: {.cell-output-display}\n![美化最终版后的企鹅三种类标准化均值雷达图（ggradar）](spider_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n## Pearl\n\n- [Hiking Locations in Washington](https://r-graph-gallery.com/web-circular-barplot-with-R-and-ggplot2.html) 的优美环状条形图\n\n![Hiking Locations in Washington](./image/washington.png)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}