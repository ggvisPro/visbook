{
  "hash": "14429710a835c73bab2f608d6303d915",
  "result": {
    "engine": "knitr",
    "markdown": "\n# Hexbin map {#sec-hexbin-map}\n\n## PKG\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)    # 数据处理与可视化核心包\nlibrary(sf)           # 用于处理空间数据\nlibrary(RColorBrewer) # 用于颜色调色板\nlibrary(viridis)      # 提供颜色调色板\nlibrary(hrbrthemes)   # 提供额外的主题样式\nlibrary(mapdata)      # 提供额外的地图数据\n```\n:::\n\n\n## 地图\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 加载必要的库\nlibrary(tidyverse)     # 加载tidyverse包，包含dplyr等数据处理工具\nlibrary(sf)            # 加载sf包，用于处理空间数据\nlibrary(RColorBrewer)  # 加载RColorBrewer包，用于颜色调色板\n\n# 从以下链接下载六边形边界的GeoJSON格式文件：\n# https://team.carto.com/u/andrew/tables/andrew.us_states_hexgrid/public/map\n\n# 读取GeoJSON格式的六边形边界文件\nmy_sf <- read_sf(\"./data/us_states_hexgrid.geojson\") \n\n# 数据格式调整，去除地名中的\" (United States)\"字符串\nmy_sf <- my_sf |>  # 使用新管道操作符\n  mutate(google_name = gsub(\" \\\\(United States\\\\)\", \"\", google_name))  # 替换地名字符串\n\n# 绘制空间数据的几何图形\nplot(st_geometry(my_sf))  # 绘制六边形边界图\n```\n\n::: {.cell-output-display}\n![美国州六边形边界地图](hexbin-map_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(my_sf) +               \n  geom_sf(fill = \"skyblue\", color = \"white\") + # 绘制六边形填充天蓝色，边界为白色\n  geom_sf_text(aes(label = iso3166_2)) +       # 添加州代码文本标签\n  theme_void()                                              \n```\n\n::: {.cell-output-display}\n![美国州六边形地图with州代码标签](hexbin-map_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 读取美国各州结婚率数据\ndata <- read.table(\"https://raw.githubusercontent.com/holtzy/R-graph-gallery/master/DATA/State_mariage_rate.csv\",\n  header = T, sep = \",\", na.strings = \"---\"\n)\n\n# 绘制2015年结婚率分布直方图\ndata |>\n  ggplot(aes(x = y_2015)) +\n  geom_histogram(bins = 20, fill = \"#69b3a2\", color = \"white\") +  # 创建直方图，设置颜色\n  scale_x_continuous(breaks = seq(1, 30))                         # 设置X轴刻度范围\n```\n\n::: {.cell-output-display}\n![2015年美国各州结婚率分布直方图](hexbin-map_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 合并地理空间数据和数值数据\nmy_sf_wed <- my_sf |>\n  left_join(data, by = c(\"google_name\" = \"state\"))\n\n# 创建第一个分级统计地图\nggplot(my_sf_wed) +\n  geom_sf(aes(fill = y_2015)) +              # 绘制地理图形，按2015年结婚率填充颜色\n  scale_fill_gradient(trans = \"log\") +       # 使用对数变换的颜色渐变\n  theme_void()                               # 使用空白主题，去除坐标轴等元素\n```\n\n::: {.cell-output-display}\n![2015年美国各州结婚率分布热力图](hexbin-map_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 准备数据分箱\nmy_sf_wed$bin <- cut(my_sf_wed$y_2015,\n  breaks = c(seq(5, 10), Inf),                                   # 设置分箱断点\n  labels = c(\"5-6\", \"6-7\", \"7-8\", \"8-9\", \"9-10\", \"10+\"),        # 设置分箱标签\n  include.lowest = TRUE                                          # 包含最小值\n)\n\n# 准备来自viridis调色板的颜色比例\nlibrary(viridis)\nmy_palette <- rev(magma(8))[c(-1, -8)]                          # 创建自定义调色板\n\n# 绘制地图\nggplot(my_sf_wed) +\n  geom_sf(aes(fill = bin), linewidth = 0, alpha = 0.9) +        # 绘制各州地理边界，按分箱填充\n  geom_sf_text(aes(label = iso3166_2), color = \"white\", size = 3, alpha = 0.6) +  # 添加州代码标签\n  theme_void() +                                                 # 使用空白主题\n  scale_fill_manual(\n    values = my_palette,                                         # 使用自定义调色板\n    name = \"Wedding per 1000 people in 2015\",                   # 图例标题\n    guide = guide_legend(\n      keyheight = unit(3, units = \"mm\"),                         # 图例高度\n      keywidth = unit(12, units = \"mm\"),                         # 图例宽度\n      label.position = \"bottom\", title.position = \"top\", nrow = 1  # 图例布局\n    )\n  ) +\n  ggtitle(\"A map of marriage rates, state by state\") +          # 添加标题\n  theme(\n    legend.position = c(0.5, 0.9),                              # 图例位置\n    text = element_text(color = \"#22211d\"),                      # 文本颜色\n    plot.background = element_rect(fill = \"#f5f5f2\", color = NA),    # 绘图背景\n    panel.background = element_rect(fill = \"#f5f5f2\", color = NA),   # 面板背景\n    legend.background = element_rect(fill = \"#f5f5f2\", color = NA),  # 图例背景\n    plot.title = element_text(\n      size = 22, hjust = 0.5, color = \"#4e4d47\",                # 标题样式\n      margin = margin(b = -0.1, t = 0.4, l = 2, unit = \"cm\")   # 标题边距\n    )\n  )\n```\n\n::: {.cell-output-display}\n![2015年美国各州结婚率分布精美地图](hexbin-map_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n## 坐标列表\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 加载所需库\nlibrary(tidyverse)\nlibrary(viridis)\nlibrary(hrbrthemes)\nlibrary(mapdata)\n\n# 从GitHub加载数据集\ndata <- read.table(\"https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/17_ListGPSCoordinates.csv\", \n                   sep = \",\", header = T)\n\n# 获取世界地图多边形数据\nworld <- map_data(\"world\")\n\n# 绘制地图\nggplot(data, aes(x = homelon, y = homelat)) +\n  geom_polygon(data = world, aes(x = long, y = lat, group = group), \n               fill = \"grey\", alpha = 0.3) +                     # 绘制世界地图底图\n  geom_bin2d(bins = 100) +                                       # 添加二维密度热力图\n  ggplot2::annotate(\"text\", x = 175, y = 80, \n                    label = \"Where people tweet about #Surf\", \n                    colour = \"black\", size = 4, alpha = 1, hjust = 1) +  # 添加标题文本\n  ggplot2::annotate(\"segment\", x = 100, xend = 175, y = 73, yend = 73, \n                    colour = \"black\", size = 0.2, alpha = 1) +   # 添加装饰线段\n  theme_void() +                                                 # 使用空白主题\n  ylim(-70, 80) +                                               # 设置Y轴范围\n  scale_fill_viridis(\n    trans = \"log\",                                               # 对数变换\n    breaks = c(1, 7, 54, 403, 3000),                           # 设置断点\n    name = \"Tweet # recorded in 8 months\",                      # 图例标题\n    guide = guide_legend(\n      keyheight = unit(2.5, units = \"mm\"),                     # 图例高度\n      keywidth = unit(10, units = \"mm\"),                       # 图例宽度\n      label.position = \"bottom\", title.position = \"top\", nrow = 1  # 图例布局\n    )\n  ) +\n  ggtitle(\"\") +                                                 # 空标题\n  theme(\n    legend.position = c(0.8, 0.09),                            # 图例位置\n    legend.title = element_text(color = \"black\", size = 8),     # 图例标题样式\n    text = element_text(color = \"#22211d\"),                     # 文本颜色\n    plot.title = element_text(size = 13, hjust = 0.1, color = \"#4e4d47\", \n                             margin = margin(b = -0.1, t = 0.4, l = 2, unit = \"cm\"))  # 标题样式\n  )\n```\n\n::: {.cell-output-display}\n![全球冲浪推文地理分布热力图](hexbin-map_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 加载所需库\nlibrary(tidyverse)\nlibrary(viridis)\nlibrary(hrbrthemes)\nlibrary(mapdata)\n\n# 从GitHub加载数据集\ndata <- read.table(\"https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/17_ListGPSCoordinates.csv\", \n                   sep = \",\", header = T)\n\n# 绘制欧洲地区六边形热力图\ndata |>\n  filter(homecontinent == \"Europe\") |>                          # 筛选欧洲地区数据\n  ggplot(aes(x = homelon, y = homelat)) +\n  geom_hex(bins = 59) +                                         # 创建六边形热力图\n  ggplot2::annotate(\"text\", x = -27, y = 72, \n                    label = \"Where people tweet about #Surf\", \n                    colour = \"black\", size = 5, alpha = 1, hjust = 0) +  # 添加标题文本\n  ggplot2::annotate(\"segment\", x = -27, xend = 10, y = 70, yend = 70, \n                    colour = \"black\", size = 0.2, alpha = 1) +   # 添加装饰线段\n  theme_void() +                                                 # 使用空白主题\n  xlim(-30, 70) +                                               # 设置X轴范围\n  ylim(24, 72) +                                                # 设置Y轴范围\n  scale_fill_viridis(\n    option = \"B\",                                               # 使用viridis调色板B选项\n    trans = \"log\",                                              # 对数变换\n    breaks = c(1, 7, 54, 403, 3000),                           # 设置断点\n    name = \"Tweet # recorded in 8 months\",                      # 图例标题\n    guide = guide_legend(\n      keyheight = unit(2.5, units = \"mm\"),                     # 图例高度\n      keywidth = unit(10, units = \"mm\"),                       # 图例宽度\n      label.position = \"bottom\", title.position = \"top\", nrow = 1  # 图例布局\n    )\n  ) +\n  ggtitle(\"\") +                                                 # 空标题\n  theme(\n    legend.position = c(0.8, 0.09),                            # 图例位置\n    legend.title = element_text(color = \"black\", size = 8),     # 图例标题样式\n    text = element_text(color = \"#22211d\"),                     # 文本颜色\n    plot.background = element_rect(fill = \"#f5f5f2\", color = NA),    # 绘图背景\n    panel.background = element_rect(fill = \"#f5f5f2\", color = NA),   # 面板背景\n    legend.background = element_rect(fill = \"#f5f5f2\", color = NA),  # 图例背景\n    plot.title = element_text(size = 13, hjust = 0.1, color = \"#4e4d47\", \n                             margin = margin(b = -0.1, t = 0.4, l = 2, unit = \"cm\"))  # 标题样式\n  )\n```\n\n::: {.cell-output-display}\n![欧洲地区冲浪推文地理分布六边形热力图](hexbin-map_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n## Pearl\n\n[![Lego Choropleth map with R](./image/choropleth-1.png)](https://r-graph-gallery.com/web-choropleth-map-lego-style.html)\n\n[![Triple map into a single chart](./image/multiple-density-map.png)](https://r-graph-gallery.com/web-triple-map-into-a-single-chart.html)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}